trigger: none

pool:
  vmImage: ubuntu-latest

stages:
- stage: validate
  jobs:
  - job: Compliance
    displayName: 'Run Terrascan'
    pool:
      vmImage: 'ubuntu-latest'
    steps:
    - script: |
        curl --location https://github.com/accurics/terrascan/releases/download/v1.4.0/terrascan_1.4.0_Linux_x86_64.tar.gz --output terrascan.tar.gz
        tar -xf terrascan.tar.gz terrascan && rm terrascan.tar.gz
        sudo install terrascan /usr/local/bin && rm terrascan
        terrascan
      displayName: 'Download tool'

    - script: |
        git clone https://github.com/Prasanna-source31/Grafana/ grafana-repo
        cd grafana-repo
        terrascan scan --exit-one
      displayName: 'Run Terrascan'
