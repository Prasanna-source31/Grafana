trigger:
- main  # Replace with the branch you want to trigger the pipeline on

pr: none  # Disable PR triggers for this example

pool:
  vmImage: 'ubuntu-latest'

steps:
- script: |
    wget -qO- https://get.helm.sh/helm-v3.7.0-linux-amd64.tar.gz | tar -xz -C /usr/local/bin --strip-components=1 linux-amd64/helm
  displayName: 'Install Helm'

- script: |
    wget -qO- https://github.com/accurics/terrascan/releases/download/v1.4.0/terrascan_1.4.0_Linux_x86_64.tar.gz | tar -xz -C /usr/local/bin terrascan && chmod +x /usr/local/bin/terrascan
  displayName: 'Install Terrascan'

- script: |
    terrascan scan -d ./ -o junit-xml > $(System.DefaultWorkingDirectory)/Terrascan-Report.xml
  displayName: 'Run Terrascan'

- task: PublishPipelineArtifact@1
  inputs:
    targetPath: '$(Build.ArtifactStagingDirectory)/Terrascan-Report.xml'
    artifact: 'TerrascanReport'

